<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html>
<head>
	<script src="../scriptaculous-js/lib/prototype.js" type="text/javascript"></script>
	<script src="../scriptaculous-js/src/scriptaculous.js" type="text/javascript"></script>
	<script src="../kbinfo/kbinfo.js" type="text/javascript"></script>
	<script src="floweditor.js" type="text/javascript"></script>
</head>
<body onload="showEditor();">

<xml id="myKB" style="display:none;">
	<kbinfo>
		<qset id="qs1" name="Alle Frageklassen">
			<child>qs2</child>
			<child>qs3</child>
		</qset>

		<qset id="qs2" name="Frageklasse 2">
			<child>mf1</child>
			<child>mf2</child>
		</qset>

		<qset id="qs3" name="Frageklasse 3">
			<child>mf3</child>
			<child>mf4</child>
			<child>msi1</child>
			<child>msi2</child>
			<child>msi3</child>
		</qset>
	 	
		<question id="mf4" name="Meine num-Frage ohne Wertebereich" type="num">
			<child>mf5</child>
			<child>mf6</child>
		</question>	
		
		<question id="mf5" name="Meine date-Frage" type="date"></question>
		
		<question id="mf6" name="Meine text-Frage" type="text"></question>
		
		<!-- Das gleiche gilt für Interpretationen -->
	
		<question id="msi1" abstract="true" name="Meine oc/mc-SI" type="oc">
			<choice>Antwortoption 1</choice>
			<choice>Antwortoption 2</choice>
		</question>
		
		<question id="msi2" abstract="true" name="Meine jn-SI" type="bool">
			<choice>Ja</choice>
			<choice>Nein</choice>
		</question>
	
		<question id="msi3" abstract="true" name="Meine num-SI" type="num"></question>
	
		<!-- ananlog für Lösungen -->
		
		<solution id="p1" name="Meine Loesung"></solution>
		
		<solution id="p2" name="Meine ausfuehrliche Loesung">
			<description>Hier ist die ausfuehrliche Reparaturanleitung für uns alle...</description>
		</solution>
		
		<!-- und final noch die Flussdiagramme -->
		
		<flowchart id="sh1" name="Wait">
			<start>2 min</start>
			<start>5 min</start>
			<start>next screening</start>
			<start>timer elapsed</start>
			<exit>done</exit>
			<exit>unexpected abort</exit>
		</flowchart>
		
	</kbinfo>
</xml>

<xml id="myAjaxKB" style="display:none;">
	<kbinfo>
		<question id="mf1" name="Meine oc/mc-Frage" type="oc">
			<text>Dies ist der Fragetext meiner Frage, kann auch entfallen!</text>
			<description>Dies ist die Beschreibung meiner Frage, kann auch entfallen!</description>
			<choice id="1">Antwortoption 1</choice>
			<choice>Antwortoption 2</choice>
		</question>
		
		<question id="mf2" name="Meine jn-Frage" type="bool"></question>
	
		<question id="mf3" name="Meine num-Frage mit Wertebereich" type="num">
			<range min="1" max="3"></range>
		</question>
		
		<solution id="p17" name="Ajax-Loesung">
			<description>Hier ist die ausführliche Reparaturanleitung für uns alle...</description>
			<child>p1</child>
		</solution>
	</kbinfo>
</xml>

<xml id="testFlowchart" style="display:none;">
	<flowchart id="sheet_01" width="801" height="601">
	
		<!-- nodes of the flowchart -->
		<node id="node_1">
			<position left="40" top="103"></position>
			<start>Start</start>
		</node>
	
		<node id="node_2">
			<position left="205" top="85"></position>
			<action markup="KnOffice">ERFRAGE["Meine oc/mc-Frage"]</action>
		</node>
	
		<node id="node_4">
			<position left="476" top="89"></position>
			<exit>Exit 1</exit>
		</node>
	
		<node id="#node_5">
			<position left="476" top="117"></position>
			<exit>Exit 2</exit>
		</node>
	
	
		<!-- rules of the flowchart -->
		<edge id="rule_3">
			<source>node_1</source>
			<target>node_2</target>
		</edge>
	
		<edge id="rule_6">
			<source>node_2</source>
			<target>node_4</target>
			<guard markup="KnOffice">"Meine oc/mc-Frage" = "Antwortoption 1"</guard>
		</edge>
	
		<edge id="#rule_7">
			<source>node_2</source>
			<target>#node_5</target>
			<guard markup="KnOffice">"Meine oc/mc-Frage" = "Antwortoption 2"</guard>
		</edge>
	
	</flowchart>
</xml>

<table>
<tr>
	<td valign=top>
		<div id=prototype_title class=rollup_title>Neu...</div>
		<div id=prototype_content class=rollup_content style="display: none;">
			<div style="max-height: 280px; overflow: auto;">
				<div style="padding: 5px;">
					<div id=action_prototype class=NodePrototype> 
						<div class=Node style="position: relative; width: 120px;">
							<div class=action>
								<div class=title>new action</div>
								<div class=text>drag this element to add a new action.</div>
							</div>
						</div>			
					</div>			
				</div>			
				<div style="padding: 5px;">
					<div id=decision_prototype class=NodePrototype>
						<div  class=Node style="position: relative; width: 120px;">
							<div class=decision>
								<div class=title>new decision</div>
								<div class=text>drag this element to add a new decision.</div>
							</div>
						</div>			
					</div>			
				</div>			
				<div style="padding: 5px;">
					<div id=exit_prototype class=NodePrototype>
						<div class=Node style="position: relative; width: 120px;">
							<div class=exit>
								<div class=title>new exit</div>
								<div class=text>drag this element to add a new exit point.</div>
							</div>
						</div>			
					</div>			
				</div>			
			</div>
		</div>
		<div id=prototype_bottom class=rollup_bottom></div>
		
		<div id=solution_title class=rollup_title>Lösungen</div>
		<div id=solution_content class=rollup_content style="display: none;">Lösung 1<BR> Lösung2<BR> ...</div>
		<div id=solution_bottom class=rollup_bottom></div>
		
		<div id=question_title class=rollup_title>Fragen</div>
		<div id=question_content class=rollup_content style="display: visible;"></div>
		<div id=question_bottom class=rollup_bottom></div>

		<div id=search_title class=rollup_title>Suche</div>
		<div id=search_content class=rollup_content style="display: none;">
			Alle: <div id=object-search></div>
			Fragen: <div id=question-search></div>
		</div>
		<div id=search_bottom class=rollup_bottom></div>

		<div id=knotentypen_title class=rollup_title>Knotentypen</div>
		<div id=knotentypen_content class=rollup_content style="display: none;">
			<div style="max-height: 280px; overflow: auto;">
				<ol>
					<li><b>Start</b>: Startknoten des Flussdiagramms (eventuell benannt wenn mehrere vorhanden sind)
					<li><b>Entscheidung Direkt</b>: 
						<ol>
							<li>Verwenden des Wertes einer Frage/Interpretation; bei oc/mc/bool die Alternativen; bei numerischen Werten ein Vergleich oder ein Intervallschema pro Linie (z.B.: = 20; <40; ]5 20]; [5 20]; …)
							<li>Verwenden des Wertes einer Formel statt des Wertes einer einzelnen Frage/Interpretation; sonst wie oben
						</ol>
					<li><b>Entscheidung Indirekt</b>: Verwenden einer benannten Bedingungskette(‚foo‘ WENN x>20; ‚bar‘ WENN y>20; ‚foobar‘ SONST;)
					<li><b>Zuweisung</b>: Setzen des Wertes einer Interpretation; automatisch auch ein Entscheidungsknoten
					<li><b>Dialog</b>: eine Frage oder mehrere Fragen oder einen Fragebogen stellen; bei einer Frage automatisch auch ein Entscheidungsknoten
					<li><b>Lösungsbewertung</b>: Bewerten einer Lösung; automatisch auch ein Entscheidungsknoten mit den etablierungsgraden als mögliche Werte sowie ‚io‘ (‚bestätigt‘) und ‚nio‘ (‚verworfen‘)
					<li><b>Flussdiagramm</b>: wie Entscheidungsknoten mit möglichen Exit-Knoten als Optionen (und möglichen Start-Knoten als Aktivierungen)
					<li><b>Exit</b>: Endknoten des Flussdiagramms (eventuell benannt wenn mehrere vorhanden sind)
				</ol>
			</div>
		</div>
		<div id=knotentypen_bottom class=rollup_bottom></div>

	</td>
	<td rowspan=2 valign=top>
		<div id=contents style="position:relative"></div>
	</td>
</tr>
<tr>
	<td valign=top>
		<a id=ajaxLink href="javascript:KBInfo._updateCache($('myAjaxKB'));">ajax</a><br>
	</td>
</tr>
</table>


<hr>
<div id=message>message</div>
<hr>

<script>
	// test kbinfo initialization
	KBInfo._updateCache($('myKB'));
	//KBInfo._updateCache($('myAjaxKB'));
	
	// make rollups responsive
	var questions =  new Rollup('question_title', 'question_content');
	var solutions =  new Rollup('solution_title', 'solution_content');
	var prototypes = new Rollup('prototype_title', 'prototype_content');
	var search = 	 new Rollup('search_title', 'search_content');
	var knotentypen = new Rollup('knotentypen_title', 'knotentypen_content');
	// and group them to display only one at the same time (can be comment out to enable independed toggle behaviour)
	new RollupGroup([questions, solutions, prototypes, search, knotentypen]);

	// initialize kb-info tools
	new ObjectSelect('object-search', null, "wait");
	new ObjectSelect('question-search', [KBInfo.Question], "wait");
	new ObjectTree('question_content', null, ['qs1', 'p1', 'p17']);

	// create example flowchart by delivered xml
	function showEditor() {
		var myFlowchart = Flowchart.createFromXML('contents', $('testFlowchart'));
		myFlowchart.setVisible(true);
	}

	// initialize prototypes to create new nodes	
	function revertIt(element,  top_offset, left_offset) {
		element = $(element);
	    element.makePositioned();
		var x = parseFloat(element.getStyle('left') || '0');
		var y = parseFloat(element.getStyle('top')  || '0');
		element.setStyle({
			left: (x - left_offset) + 'px',
			top:  (y - top_offset) + 'px'
		});
	}

	new Draggable('action_prototype', { ghosting: true, revert: true, reverteffect: revertIt, starteffect: null });
	new Draggable('decision_prototype', { ghosting: true, revert: true, reverteffect: revertIt, starteffect: null });
	new Draggable('exit_prototype', { ghosting: true, revert: true, reverteffect: revertIt, starteffect: null });
	$('action_prototype').createNode = function(flowchart, left, top) { createActionNode(flowchart, left, top, {action: { markup: 'KnOffice', expression: ''}}); };
	$('decision_prototype').createNode = function(flowchart, left, top) { createActionNode(flowchart, left, top, {action: { markup: 'NOP', expression: ''}}); };
	$('exit_prototype').createNode = function(flowchart, left, top) { createActionNode(flowchart, left, top, {exit: 'my Exit'}); };
	var mfCounter = 100;
	
	function createActionNode(flowchart, left, top, nodeModel) {
		//nodeModel.id = 'mf'+(mfCounter++); 
		nodeModel.position = {left: left, top: top};
		var node = new Node(flowchart, nodeModel);
		node.select();
		node.edit();
	};

</script>

</body>
</html>